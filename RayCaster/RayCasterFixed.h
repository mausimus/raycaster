#pragma once
#include "RayCaster.h"
class RayCasterFixed :
	public RayCaster
{
protected:
	uint8_t* _map;
	uint16_t _px;
	uint16_t _py;
	int16_t _pa;
	uint8_t _qtr;
	uint8_t _qa;

	uint16_t _tan[256] = { 0,1,3,4,6,7,9,11,12,14,15,17,18,20,22,23,25,26,28,29,31,33,34,36,37,39,41,42,44,46,47,49,50,52,54,55,57,59,60,62,64,65,67,69,70,72,74,75,77,79,81,82,84,86,88,89,91,93,95,96,98,100,102,104,106,107,109,111,113,115,117,119,121,123,124,126,128,130,132,134,136,138,140,142,145,147,149,151,153,155,157,159,162,164,166,168,171,173,175,177,180,182,185,187,189,192,194,197,199,202,204,207,210,212,215,218,220,223,226,229,232,234,237,240,243,246,249,252,255,259,262,265,268,272,275,278,282,285,289,293,296,300,304,308,311,315,319,323,328,332,336,340,345,349,354,358,363,368,373,378,383,388,393,398,404,409,415,421,427,433,439,445,451,458,465,471,478,486,493,500,508,516,524,532,541,549,558,568,577,587,597,607,618,628,640,651,663,675,688,701,715,729,744,759,774,791,808,825,843,862,882,903,925,947,971,996,1022,1049,1077,1108,1140,1173,1209,1246,1286,1329,1374,1423,1475,1531,1591,1655,1725,1801,1884,1975,2075,2185,2308,2445,2599,2773,2972,3202,3470,3787,4166,4631,5210,5956,6950,8341,10428,13905,20859,41720 };

	uint16_t _cotan[256] = { 0,41720,20859,13905,10428,8341,6950,5956,5210,4631,4166,3787,3470,3202,2972,2773,2599,2445,2308,2185,2075,1975,1884,1801,1725,1655,1591,1531,1475,1423,1374,1329,1286,1246,1209,1173,1140,1108,1077,1049,1022,996,971,947,925,903,882,862,843,825,808,791,774,759,744,729,715,701,688,675,663,651,640,628,618,607,597,587,577,568,558,549,541,532,524,516,508,500,493,486,478,471,465,458,451,445,439,433,427,421,415,409,404,398,393,388,383,378,373,368,363,358,354,349,345,340,336,332,328,323,319,315,311,308,304,300,296,293,289,285,282,278,275,272,268,265,262,259,256,252,249,246,243,240,237,234,232,229,226,223,220,218,215,212,210,207,204,202,199,197,194,192,189,187,185,182,180,177,175,173,171,168,166,164,162,159,157,155,153,151,149,147,145,142,140,138,136,134,132,130,128,126,124,123,121,119,117,115,113,111,109,107,106,104,102,100,98,96,95,93,91,89,88,86,84,82,81,79,77,75,74,72,70,69,67,65,64,62,60,59,57,55,54,52,50,49,47,46,44,42,41,39,37,36,34,33,31,29,28,26,25,23,22,20,18,17,15,14,12,11,9,7,6,4,3,1 };

	uint8_t _sin[256] = { 0,1,3,4,6,7,9,10,12,14,15,17,18,20,21,23,25,26,28,29,31,32,34,36,37,39,40,42,43,45,46,48,49,51,53,54,56,57,59,60,62,63,65,66,68,69,71,72,74,75,77,78,80,81,83,84,86,87,89,90,92,93,95,96,97,99,100,102,103,105,106,108,109,110,112,113,115,116,117,119,120,122,123,124,126,127,128,130,131,132,134,135,136,138,139,140,142,143,144,146,147,148,149,151,152,153,155,156,157,158,159,161,162,163,164,166,167,168,169,170,171,173,174,175,176,177,178,179,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,211,212,213,214,215,216,217,217,218,219,220,221,221,222,223,224,225,225,226,227,227,228,229,230,230,231,232,232,233,234,234,235,235,236,237,237,238,238,239,239,240,241,241,242,242,243,243,244,244,244,245,245,246,246,247,247,247,248,248,249,249,249,250,250,250,251,251,251,251,252,252,252,252,253,253,253,253,254,254,254,254,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255 };

	uint8_t _cos[256] = { 0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,254,254,254,254,254,253,253,253,253,252,252,252,252,251,251,251,251,250,250,250,249,249,249,248,248,247,247,247,246,246,245,245,244,244,244,243,243,242,242,241,241,240,239,239,238,238,237,237,236,235,235,234,234,233,232,232,231,230,230,229,228,227,227,226,225,225,224,223,222,221,221,220,219,218,217,217,216,215,214,213,212,211,211,210,209,208,207,206,205,204,203,202,201,200,199,198,197,196,195,194,193,192,191,190,189,188,187,186,185,184,183,182,181,179,178,177,176,175,174,173,171,170,169,168,167,166,164,163,162,161,159,158,157,156,155,153,152,151,149,148,147,146,144,143,142,140,139,138,136,135,134,132,131,130,128,127,126,124,123,122,120,119,117,116,115,113,112,110,109,108,106,105,103,102,100,99,97,96,95,93,92,90,89,87,86,84,83,81,80,78,77,75,74,72,71,69,68,66,65,63,62,60,59,57,56,54,53,51,49,48,46,45,43,42,40,39,37,36,34,32,31,29,28,26,25,23,21,20,18,17,15,14,12,10,9,7,6,4,3,1 };

	uint8_t _neard[256] = { 100,98,96,95,94,92,91,90,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,71,70,69,68,68,67,66,65,65,64,64,63,62,62,61,60,60,59,59,58,58,57,57,56,56,55,55,54,54,53,53,52,52,52,51,51,50,50,50,49,49,48,48,48,47,47,47,46,46,46,45,45,45,44,44,44,43,43,43,42,42,42,42,41,41,41,41,40,40,40,40,39,39,39,39,38,38,38,38,37,37,37,37,36,36,36,36,36,35,35,35,35,35,34,34,34,34,34,34,33,33,33,33,33,32,32,32,32,32,32,32,31,31,31,31,31,31,30,30,30,30,30,30,30,29,29,29,29,29,29,29,28,28,28,28,28,28,28,28,27,27,27,27,27,27,27,27,27,26,26,26,26,26,26,26,26,26,25,25,25,25,25,25,25,25,25,25,24,24,24,24,24,24,24,24,24,24,23,23,23,23,23,23,23,23,23,23,23,23,22,22,22,22,22,22,22,22,22,22,22,22,21,21,21,21,21,21,21,21,21,21,21,21,21,21,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20 };

	uint8_t _fard[256] = { 100,88,80,72,66,61,57,53,50,47,44,42,40,38,36,34,33,32,30,29,28,27,26,25,25,24,23,22,22,21,21,20,20,19,19,18,18,17,17,17,16,16,16,15,15,15,14,14,14,14,13,13,13,13,12,12,12,12,12,11,11,11,11,11,11,10,10,10,10,10,10,10,10,9,9,9,9,9,9,9,9,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3 };

	uint16_t _nears[256] = { 327,332,337,343,348,353,358,363,368,373,378,384,389,394,399,404,409,414,419,424,430,435,440,445,450,455,460,465,471,476,481,486,491,496,501,506,512,517,522,527,532,537,542,547,552,558,563,568,573,578,583,588,593,599,604,609,614,619,624,629,634,640,645,650,655,660,665,670,675,680,686,691,696,701,706,711,716,721,727,732,737,742,747,752,757,762,768,773,778,783,788,793,798,803,808,814,819,824,829,834,839,844,849,855,860,865,870,875,880,885,890,895,901,906,911,916,921,926,931,936,942,947,952,957,962,967,972,977,983,988,993,998,1003,1008,1013,1018,1024,1029,1034,1039,1044,1049,1054,1059,1064,1070,1075,1080,1085,1090,1095,1100,1105,1111,1116,1121,1126,1131,1136,1141,1146,1152,1157,1162,1167,1172,1177,1182,1187,1192,1198,1203,1208,1213,1218,1223,1228,1233,1239,1244,1249,1254,1259,1264,1269,1274,1280,1285,1290,1295,1300,1305,1310,1315,1320,1326,1331,1336,1341,1346,1351,1356,1361,1367,1372,1377,1382,1387,1392,1397,1402,1408,1413,1418,1423,1428,1433,1438,1443,1448,1454,1459,1464,1469,1474,1479,1484,1489,1495,1500,1505,1510,1515,1520,1525,1530,1536,1541,1546,1551,1556,1561,1566,1571,1576,1582,1587,1592,1597,1602,1607,1612,1617,1623,1628,1633 };

	uint16_t _fars[256] = { 327,368,409,450,491,532,573,614,655,696,737,778,819,860,901,942,983,1024,1064,1105,1146,1187,1228,1269,1310,1351,1392,1433,1474,1515,1556,1597,1638,1679,1720,1761,1802,1843,1884,1925,1966,2007,2048,2088,2129,2170,2211,2252,2293,2334,2375,2416,2457,2498,2539,2580,2621,2662,2703,2744,2785,2826,2867,2908,2949,2990,3031,3072,3112,3153,3194,3235,3276,3317,3358,3399,3440,3481,3522,3563,3604,3645,3686,3727,3768,3809,3850,3891,3932,3973,4014,4055,4096,4136,4177,4218,4259,4300,4341,4382,4423,4464,4505,4546,4587,4628,4669,4710,4751,4792,4833,4874,4915,4956,4997,5038,5079,5120,5160,5201,5242,5283,5324,5365,5406,5447,5488,5529,5570,5611,5652,5693,5734,5775,5816,5857,5898,5939,5980,6021,6062,6103,6144,6184,6225,6266,6307,6348,6389,6430,6471,6512,6553,6594,6635,6676,6717,6758,6799,6840,6881,6922,6963,7004,7045,7086,7127,7167,7208,7249,7290,7331,7372,7413,7454,7495,7536,7577,7618,7659,7700,7741,7782,7823,7864,7905,7946,7987,8028,8069,8110,8151,8192,8232,8273,8314,8355,8396,8437,8478,8519,8560,8601,8642,8683,8724,8765,8806,8847,8888,8929,8970,9011,9052,9093,9134,9175,9216,9256,9297,9338,9379,9420,9461,9502,9543,9584,9625,9666,9707,9748,9789,9830,9871,9912,9953,9994,10035,10076,10117,10158,10199,10240,10280,10321,10362,10403,10444,10485,10526,10567,10608,10649,10690,10731,10772 };

	uint16_t _shorto[256] = { 0,32640,32512,32384,32256,32128,32000,31872,31744,31616,31488,31360,31232,31104,30976,30848,30720,30592,30464,30336,30208,30080,29952,29824,29696,29568,29440,29312,29184,29055,28928,28800,28672,28544,28416,28288,28160,28032,27904,27776,27648,27520,27392,27264,27136,27008,26880,26752,26624,26496,26368,26240,26112,25984,25856,25728,25600,25472,25343,25216,25088,24960,24832,24704,24576,24448,24320,24192,24064,23936,23808,23680,23552,23424,23296,23168,23040,22912,22784,22656,22528,22400,22272,22144,22016,21888,21760,21632,21504,21376,21248,21120,20992,20864,20736,20608,20480,20351,20224,20096,19968,19840,19712,19583,19456,19328,19200,19072,18944,18816,18688,18560,18432,18304,18176,18048,17919,17792,17664,17536,17408,17280,17152,17024,16896,16768,16640,16511,16384,16256,16128,16000,15872,15744,15615,15487,15360,15232,15104,14976,14848,14720,14592,14464,14335,14208,14080,13952,13824,13696,13568,13440,13312,13184,13055,12928,12800,12672,12544,12416,12288,12160,12031,11904,11776,11648,11520,11392,11264,11136,11008,10879,10751,10624,10495,10368,10240,10112,9984,9855,9728,9600,9472,9344,9216,9087,8960,8831,8704,8576,8448,8320,8191,8063,7935,7808,7680,7551,7423,7296,7168,7039,6912,6784,6656,6528,6399,6272,6143,6015,5888,5759,5632,5503,5376,5248,5119,4992,4863,4735,4608,4480,4352,4223,4095,3968,3840,3711,3583,3455,3327,3199,3071,2944,2816,2688,2560,2431,2304,2175,2047,1920,1792,1663,1535,1408,1280,1151,1024,896,768,640,512,383,255,128 };

	uint16_t _shorts[256] = { 0,1,2,3,5,6,7,8,10,11,12,14,15,16,17,19,20,21,23,24,25,26,28,29,30,32,33,34,35,37,38,39,40,42,43,44,46,47,48,49,51,52,53,55,56,57,58,60,61,62,64,65,66,67,69,70,71,72,74,75,76,78,79,80,81,83,84,85,87,88,89,90,92,93,94,96,97,98,99,101,102,103,104,106,107,108,110,111,112,113,115,116,117,119,120,121,122,124,125,126,128,129,130,131,133,134,135,136,138,139,140,142,143,144,145,147,148,149,151,152,153,154,156,157,158,160,161,162,163,165,166,167,168,170,171,172,174,175,176,177,179,180,181,183,184,185,186,188,189,190,192,193,194,195,197,198,199,200,202,203,204,206,207,208,209,211,212,213,215,216,217,218,220,221,222,223,225,226,227,229,230,231,232,234,235,236,238,239,240,241,243,244,245,247,248,249,250,252,253,254,256,257,258,259,261,262,263,264,266,267,268,270,271,272,273,275,276,277,279,280,281,282,284,285,286,288,289,290,291,293,294,295,296,298,299,300,302,303,304,305,307,308,309,311,312,313,314,316,317,318,320,321,322,323,325,326 };

	uint16_t _da[SCREEN_WIDTH] = { 912,913,914,915,915,916,917,917,918,919,919,920,921,922,922,923,924,924,925,926,926,927,928,929,929,930,931,931,932,933,934,934,935,936,936,937,938,938,939,940,941,941,942,943,943,944,945,945,946,947,947,948,949,950,950,951,952,952,953,954,954,955,956,957,957,958,959,959,960,961,961,962,963,964,964,965,966,966,967,968,968,969,970,971,971,972,973,973,974,975,975,976,977,978,978,979,980,980,981,982,983,983,984,985,985,986,987,987,988,989,989,990,991,992,992,993,994,994,995,996,996,997,998,999,999,1000,1001,1001,1002,1003,1004,1004,1005,1006,1006,1007,1008,1008,1009,1010,1010,1011,1012,1013,1013,1014,1015,1015,1016,1017,1017,1018,1019,1020,1020,1021,1022,1022,1023,0,0,0,1,2,2,3,4,4,5,6,7,7,8,9,9,10,11,11,12,13,14,14,15,16,16,17,18,18,19,20,20,21,22,23,23,24,25,25,26,27,28,28,29,30,30,31,32,32,33,34,35,35,36,37,37,38,39,39,40,41,41,42,43,44,44,45,46,46,47,48,49,49,50,51,51,52,53,53,54,55,56,56,57,58,58,59,60,60,61,62,63,63,64,65,65,66,67,67,68,69,70,70,71,72,72,73,74,74,75,76,77,77,78,79,79,80,81,81,82,83,83,84,85,86,86,87,88,88,89,90,90,91,92,93,93,94,95,95,96,97,98,98,99,100,100,101,102,102,103,104,105,105,106,107,107,108,109,109,110,111 };

	void Distance(uint16_t _sx, uint16_t _sy, uint16_t ra, int16_t *dx, int16_t *dy, uint8_t* textureNo, uint8_t* textureX);

	bool IsWall(uint8_t bx, uint8_t by, uint8_t sx, uint8_t sy);

	int16_t MulTan(uint8_t v, uint8_t i, uint8_t qtr, uint8_t a, uint16_t* fun);

	int16_t AbsTan(uint8_t qtr, uint8_t a, uint16_t* fun);

	uint16_t Mul(uint8_t v, uint16_t f);

	int16_t MulS(uint8_t v, int16_t f);

	void Height(uint16_t d, uint8_t* h, uint16_t *ts);

	void Precalculate();

public:
	void Start(uint16_t playerX, uint16_t playerY, int16_t playerA);

	void Trace(uint16_t screenX, uint8_t* screenY, uint8_t* textureNo, uint8_t* textureX, uint16_t* textureY, uint16_t* textureStep);

	RayCasterFixed(uint8_t* map);
	~RayCasterFixed();
};

